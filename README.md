# crypto-kakutei
総平均法に基づく暗号通貨の確定申告用スクリプトです。**以下の注意事項をよくお読みになってからご利用ください。**

暗号資産の確定申告における取得価格の計算には、総平均法または移動平均法が用いられますが、個人の場合事前の届け出がない場合、総平均法が適用されます。詳しくは[国税庁: 暗号資産に関する税務上の取扱い及び計算書について（令和3年12月）](https://www.nta.go.jp/publication/pamph/shotoku/kakuteishinkokukankei/kasoutuka/)の計算例（たとえば4ページ）をご確認ください。

# 注意事項
* このレポジトリに含まれるプログラムの開発者およびコントリビュータは、不正確な確定申告による税務上のトラブル、もしくは本プログラムが招いたいかなる損害についても責任を追うことはありませんを負いません。
* 必ずご自身の責任のもとに計算結果を確認してください。
* とくに、暗号資産に関する税務上の取り扱いは年々変化しておりますので必ず[国税庁: 暗号資産に関する税務上の取扱い及び計算書について（令和3年12月）](https://www.nta.go.jp/publication/pamph/shotoku/kakuteishinkokukankei/kasoutuka/)を御覧ください。

# 使い方
## ご使用になる前に
[国税庁のページ](https://www.nta.go.jp/publication/pamph/shotoku/kakuteishinkokukankei/kasoutuka/)では、移動平均法、総平均法に基づく損益計算ができるExcelファイルが配布されています。今年度の開始時における、指定した方法によって計算された通貨の取得価格がわかっている場合はこれらのExcelファイルで損益通算を行うのが簡単です。また、今年度から暗号通貨の取引を始めた方もこのExcelファイルを使うことができます。

そうではない方、つまり昨年度以前より暗号通貨の取引を行っていたが、利益が少なく確定申告を行わなかった方や、以前から積立等により複数回通貨を購入しており、総平均法（もしくは移動平均法）による取得価格の計算が大変な方は本プログラムを使用すると便利です。

## 暗号資産の確定申告における基礎知識
情報は令和3年度のものです。暗号資産の税務上の取り扱いは株式やFXとは異なります。今後税制が変化する可能性もありますので、必ず[国税庁: 暗号資産に関する税務上の取扱い及び計算書について（令和3年12月）](https://www.nta.go.jp/publication/pamph/shotoku/kakuteishinkokukankei/kasoutuka/)をご確認ください。
* 暗号資産の所得は雑所得に分類されます。このため、損失が出た場合にも会社の収入等と通算することはできません。
* 雑所得は株式の20%税率と異なり、累進課税です。
* 雑所得内での損益通算は可能なため、暗号資産同士の損益は通算できます。
* 雑所得が20万円を超える場合、確定申告が必要となります。損失の場合は確定申告をしてもしなくても変わりません。
* 年度の繰越はできません。たとえば、前年度で100万円の損失があり、今年度で200万の利益があるとき、課税は200万円に対して行われます。もし前年度で100万円の含み損だったものが今年度100万円の含み益になり、その時点利確した場合、前者と同じような変動であっても利益が確定した100万円に対する課税になります。
* 複数の通貨を保有している場合、年度ごとの損益は各通貨について独立に計算した結果の和となります。

```python
manager = PeriodicAveraged("xrp")

# 2017年に 200.0 jpy/xrp で 500 xrp 購入 (100000円)
manager.register_buy(2017, 200.0, 500)
# 2017年に 250.0 jpy/xrp で 100 xrp 売却 (25000円)
manager.register_sell(2017, 250.0, 100)

manager.register_sell(2021, 80.0, 300)
manager.register_buy(2021, 60.0, 50)


# Prints: {2017: 5000.0, 2018: 0.0, 2019: 0.0, 2020: 0.0, 2021: -31333.333333333336}
print(manager.get_profits())
```

# コントリビュータを募集しています
本プログラムの信頼を高めるためにも、プログラマの方、税に詳しい方の協力を募集しています。
プログラムのバグ等を発見された方はぜひissueにて報告してください。
